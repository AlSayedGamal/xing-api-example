require 'rails_helper'

RSpec.describe User, type: :model do
  it "should create new user from object passed" do
  	user = User.create_from_xing(JSON.parse('{"provider":"xing","uid":"6156679_f57bad","info":{"first_name":"AlSayed","last_name":"AbdulAzeem","email":"mail.gamal@gmail.com","image":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.128x128.jpg","url":"https://www.xing.com/profile/AlSayed_AbdulAzeem","name":"AlSayed AbdulAzeem","urls":{"public_profile":"https://www.xing.com/profile/AlSayed_AbdulAzeem"}},"credentials":{"token":"29bbf7bca126b332fcca","secret":"b5aadf842531769ab0ea"},"extra":{"access_token":{"token":"29bbf7bca126b332fcca","secret":"b5aadf842531769ab0ea","consumer":{"key":"c5a8fa5cbc63d8090bfa","secret":"1336afa51cda96edde35f6c86783dca57f789aff","options":{"signature_method":"HMAC-SHA1","request_token_path":"/v1/request_token","authorize_path":"/v1/authorize","access_token_path":"/v1/access_token","proxy":null,"scheme":"header","http_method":"post","oauth_version":"1.0","site":"https://api.xing.com"},"uri":{"scheme":"https","user":null,"password":null,"host":"api.xing.com","port":443,"path":"","query":null,"opaque":null,"fragment":null,"parser":{"regexp":{"SCHEME":"(?-mix:\\A[A-Za-z][A-Za-z0-9+\\-.]*\\z)","USERINFO":"(?-mix:\\A(?:%\\h\\h|[!$\u0026-.0-;=A-Z_a-z~])*\\z)","HOST":"(?-mix:\\A(?:(?\u003cIP-literal\u003e\\[(?:(?\u003cIPv6address\u003e(?:\\h{1,4}:){6}(?\u003cls32\u003e\\h{1,4}:\\h{1,4}|(?\u003cIPv4address\u003e(?\u003cdec-octet\u003e[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5]|\\d)\\.\\g\u003cdec-octet\u003e\\.\\g\u003cdec-octet\u003e\\.\\g\u003cdec-octet\u003e))|::(?:\\h{1,4}:){5}\\g\u003cls32\u003e|\\h{,4}::(?:\\h{1,4}:){4}\\g\u003cls32\u003e|(?:(?:\\h{1,4}:)?\\h{1,4})?::(?:\\h{1,4}:){3}\\g\u003cls32\u003e|(?:(?:\\h{1,4}:){,2}\\h{1,4})?::(?:\\h{1,4}:){2}\\g\u003cls32\u003e|(?:(?:\\h{1,4}:){,3}\\h{1,4})?::\\h{1,4}:\\g\u003cls32\u003e|(?:(?:\\h{1,4}:){,4}\\h{1,4})?::\\g\u003cls32\u003e|(?:(?:\\h{1,4}:){,5}\\h{1,4})?::\\h{1,4}|(?:(?:\\h{1,4}:){,6}\\h{1,4})?::)|(?\u003cIPvFuture\u003ev\\h+\\.[!$\u0026-.0-;=A-Z_a-z~]+))\\])|\\g\u003cIPv4address\u003e|(?\u003creg-name\u003e(?:%\\h\\h|[!$\u0026-.0-9;=A-Z_a-z~])*))\\z)","ABS_PATH":"(?-mix:\\A\\/(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~])*(?:\\/(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~])*)*\\z)","REL_PATH":"(?-mix:\\A(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~])+(?:\\/(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~])*)*\\z)","QUERY":"(?-mix:\\A(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~\\/?])*\\z)","FRAGMENT":"(?-mix:\\A(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~\\/?])*\\z)","OPAQUE":"(?-mix:\\A(?:[^\\/].*)?\\z)","PORT":"(?-mix:\\A[\\x09\\x0a\\x0c\\x0d ]*\\d*[\\x09\\x0a\\x0c\\x0d ]*\\z)"}}},"http":{"address":"api.xing.com","port":443,"local_host":null,"local_port":null,"curr_http_version":"1.1","keep_alive_timeout":2,"last_communicated":null,"close_on_empty_response":false,"socket":null,"started":false,"open_timeout":30,"read_timeout":30,"continue_timeout":null,"debug_output":null,"proxy_from_env":true,"proxy_uri":null,"proxy_address":null,"proxy_port":null,"proxy_user":null,"proxy_pass":null,"use_ssl":true,"ssl_context":{"cert":null,"key":null,"client_ca":null,"ca_file":"/etc/ssl/certs/ca-certificates.crt","ca_path":null,"timeout":null,"verify_mode":1,"verify_depth":5,"renegotiation_cb":null,"verify_callback":null,"cert_store":null,"extra_chain_cert":null,"client_cert_cb":null,"session_id_context":null,"tmp_dh_callback":null,"session_get_cb":null,"session_new_cb":null,"session_remove_cb":null,"tmp_ecdh_callback":null,"servername_cb":null,"npn_protocols":null,"alpn_protocols":null,"alpn_select_cb":null,"npn_select_cb":null},"ssl_session":{},"sspi_enabled":false,"ca_file":"/etc/ssl/certs/ca-certificates.crt","ca_path":null,"cert":null,"cert_store":null,"ciphers":null,"key":null,"ssl_timeout":null,"ssl_version":null,"verify_callback":null,"verify_depth":5,"verify_mode":1},"http_method":"post"},"params":{"oauth_token":"29bbf7bca126b332fcca","oauth_token_secret":"b5aadf842531769ab0ea","user_id":"6156679_f57bad"},"response":{"date":["Thu, 30 Jun 2016 06:36:05 GMT"],"server":["Apache"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block"],"x-content-type-options":["nosniff"],"access-control-allow-origin":["*"],"access-control-allow-methods":["GET,POST,OPTIONS"],"access-control-allow-headers":["Content-Type"],"access-control-allow-credentials":["false"],"access-control-max-age":["60"],"content-disposition":["attachment"],"cache-control":["max-age=0, private, must-revalidate"],"x-logjam-request-id":["xws-production-97cdf7854baf41ceb026a0cbcab7bd06"],"x-logjam-request-action":["WebService::EndpointController#get_v1_users_me"],"x-request-id":["97c2c54a-265d-40f2-9c69-57f90a84278f"],"x-runtime":["0.163394"],"x-powered-by":["Phusion Passenger 4.0.60"],"set-cookie":["c_=5b5052e30c89f36eb5020ef50d9777de; domain=.xing.com; path=/; expires=Fri, 01 Jul 2016 06:36:05 -0000; secure; HttpOnly"],"etag":["W/\"0e36daef29dccf3d1f30809c037a8a23-gzip\""],"status":["200 OK"],"vary":["Accept-Encoding"],"content-length":["1279"],"content-type":["application/json; charset=utf-8"]}},"raw_info":{"id":"6156679_f57bad","active_email":"mail.gamal@gmail.com","time_zone":{"utc_offset":2.0,"name":"Africa/Cairo"},"display_name":"AlSayed AbdulAzeem","academic_title":null,"first_name":"AlSayed","last_name":"AbdulAzeem","gender":"m","page_name":"AlSayed_AbdulAzeem","birth_date":{"year":1988,"month":3,"day":29},"wants":"Software Engineering, Data Engineering","haves":"PHP,Python,Django Framework,Ruby on Rails,Scala,openstack,linux,AWS,Ruby,Node.js,angularJS","top_haves":null,"interests":null,"web_profiles":{},"badges":[],"legal_information":{"preview_content":null},"photo_urls":{"large":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.140x185.jpg","maxi_thumb":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.70x93.jpg","medium_thumb":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.57x75.jpg","mini_thumb":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.18x24.jpg","thumb":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.30x40.jpg","size_32x32":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.32x32.jpg","size_48x48":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.48x48.jpg","size_64x64":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.64x64.jpg","size_96x96":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.96x96.jpg","size_128x128":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.128x128.jpg","size_192x192":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.192x192.jpg","size_256x256":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.256x256.jpg","size_1024x1024":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.1024x1024.jpg","size_original":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.original.jpg"},"photo_attributes":{"uploaded":true},"permalink":"https://www.xing.com/profile/AlSayed_AbdulAzeem","languages":{"en":null},"employment_status":"EMPLOYEE","organisation_member":null,"instant_messaging_accounts":{},"educational_background":{"degree":"BsC Electronics  and ComputerEngineering","primary_school":null,"schools":[{"name":"Mansoura University","subject":"Computer Engineering","degree":"BSC Electronics and Computer Engineering","begin_date":"2005-09","end_date":"2011-11","notes":null,"id":"1_dc3ed0"}],"qualifications":[]},"professional_experience":{"primary_company":{"id":"4728080_6c4623","name":"MaTeS","url":"http://www.3MaTeS.com","tag":"MATES","title":"ENG","begin_date":null,"end_date":null,"description":null,"discipline":null,"until_now":true,"industry":"OTHERS","industries":[{"id":230000,"localized_name":"Other"}],"company_size":null,"career_level":null,"form_of_employment":"FULL_TIME_EMPLOYEE"},"companies":[{"id":"4728080_6c4623","name":"MaTeS","url":"http://www.3MaTeS.com","tag":"MATES","title":"ENG","begin_date":null,"end_date":null,"description":null,"discipline":null,"until_now":true,"industry":"OTHERS","industries":[{"id":230000,"localized_name":"Other"}],"company_size":null,"career_level":null,"form_of_employment":"FULL_TIME_EMPLOYEE"},{"id":"4728083_60c11f","name":"CAT","url":"http://www.catreloaded.com","tag":"CAT","title":"Eng","begin_date":null,"end_date":null,"description":null,"discipline":null,"until_now":true,"industry":"OTHERS","industries":[{"id":230000,"localized_name":"Other"}],"company_size":null,"career_level":null,"form_of_employment":"FULL_TIME_EMPLOYEE"}],"awards":[],"non_primary_companies":[{"_this_is_deprecated_since":"2014-05-08","name":"CAT","url":"http://www.catreloaded.com","tag":"CAT","title":"Eng","begin_date":null,"end_date":null,"description":null,"industry":"OTHERS","company_size":null,"career_level":null}]},"private_address":{"street":null,"zip_code":null,"city":null,"province":null,"country":null,"email":null,"fax":null,"phone":null,"mobile_phone":null},"business_address":{"street":"39 Becho American City Zahraa Maadi Cairo","zip_code":"11435","city":"Mansourah","province":null,"country":"EG","email":"mail.gamal@gmail.com","fax":null,"phone":null,"mobile_phone":null},"premium_services":[]}}}', object_class: OpenStruct))
		user.first_name.should equal? "AlSayed"
		user.last_name.should equal? "AbdulAzeem"
		user.id.should equal? 1
		user.token.should equal? "29bbf7bca126b332fcca"
		user.secret.should equal? "b5aadf842531769ab0ea"
	end
	it "should return the same user id if it has the same provider and uid values" do
		user = User.create_from_xing(JSON.parse('{"provider":"xing","uid":"6156679_f57bad","info":{"first_name":"AlSayed","last_name":"AbdulAzeem","email":"mail.gamal@gmail.com","image":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.128x128.jpg","url":"https://www.xing.com/profile/AlSayed_AbdulAzeem","name":"AlSayed AbdulAzeem","urls":{"public_profile":"https://www.xing.com/profile/AlSayed_AbdulAzeem"}},"credentials":{"token":"29bbf7bca126b332fcca","secret":"b5aadf842531769ab0ea"},"extra":{"access_token":{"token":"29bbf7bca126b332fcca","secret":"b5aadf842531769ab0ea","consumer":{"key":"c5a8fa5cbc63d8090bfa","secret":"1336afa51cda96edde35f6c86783dca57f789aff","options":{"signature_method":"HMAC-SHA1","request_token_path":"/v1/request_token","authorize_path":"/v1/authorize","access_token_path":"/v1/access_token","proxy":null,"scheme":"header","http_method":"post","oauth_version":"1.0","site":"https://api.xing.com"},"uri":{"scheme":"https","user":null,"password":null,"host":"api.xing.com","port":443,"path":"","query":null,"opaque":null,"fragment":null,"parser":{"regexp":{"SCHEME":"(?-mix:\\A[A-Za-z][A-Za-z0-9+\\-.]*\\z)","USERINFO":"(?-mix:\\A(?:%\\h\\h|[!$\u0026-.0-;=A-Z_a-z~])*\\z)","HOST":"(?-mix:\\A(?:(?\u003cIP-literal\u003e\\[(?:(?\u003cIPv6address\u003e(?:\\h{1,4}:){6}(?\u003cls32\u003e\\h{1,4}:\\h{1,4}|(?\u003cIPv4address\u003e(?\u003cdec-octet\u003e[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5]|\\d)\\.\\g\u003cdec-octet\u003e\\.\\g\u003cdec-octet\u003e\\.\\g\u003cdec-octet\u003e))|::(?:\\h{1,4}:){5}\\g\u003cls32\u003e|\\h{,4}::(?:\\h{1,4}:){4}\\g\u003cls32\u003e|(?:(?:\\h{1,4}:)?\\h{1,4})?::(?:\\h{1,4}:){3}\\g\u003cls32\u003e|(?:(?:\\h{1,4}:){,2}\\h{1,4})?::(?:\\h{1,4}:){2}\\g\u003cls32\u003e|(?:(?:\\h{1,4}:){,3}\\h{1,4})?::\\h{1,4}:\\g\u003cls32\u003e|(?:(?:\\h{1,4}:){,4}\\h{1,4})?::\\g\u003cls32\u003e|(?:(?:\\h{1,4}:){,5}\\h{1,4})?::\\h{1,4}|(?:(?:\\h{1,4}:){,6}\\h{1,4})?::)|(?\u003cIPvFuture\u003ev\\h+\\.[!$\u0026-.0-;=A-Z_a-z~]+))\\])|\\g\u003cIPv4address\u003e|(?\u003creg-name\u003e(?:%\\h\\h|[!$\u0026-.0-9;=A-Z_a-z~])*))\\z)","ABS_PATH":"(?-mix:\\A\\/(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~])*(?:\\/(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~])*)*\\z)","REL_PATH":"(?-mix:\\A(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~])+(?:\\/(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~])*)*\\z)","QUERY":"(?-mix:\\A(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~\\/?])*\\z)","FRAGMENT":"(?-mix:\\A(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~\\/?])*\\z)","OPAQUE":"(?-mix:\\A(?:[^\\/].*)?\\z)","PORT":"(?-mix:\\A[\\x09\\x0a\\x0c\\x0d ]*\\d*[\\x09\\x0a\\x0c\\x0d ]*\\z)"}}},"http":{"address":"api.xing.com","port":443,"local_host":null,"local_port":null,"curr_http_version":"1.1","keep_alive_timeout":2,"last_communicated":null,"close_on_empty_response":false,"socket":null,"started":false,"open_timeout":30,"read_timeout":30,"continue_timeout":null,"debug_output":null,"proxy_from_env":true,"proxy_uri":null,"proxy_address":null,"proxy_port":null,"proxy_user":null,"proxy_pass":null,"use_ssl":true,"ssl_context":{"cert":null,"key":null,"client_ca":null,"ca_file":"/etc/ssl/certs/ca-certificates.crt","ca_path":null,"timeout":null,"verify_mode":1,"verify_depth":5,"renegotiation_cb":null,"verify_callback":null,"cert_store":null,"extra_chain_cert":null,"client_cert_cb":null,"session_id_context":null,"tmp_dh_callback":null,"session_get_cb":null,"session_new_cb":null,"session_remove_cb":null,"tmp_ecdh_callback":null,"servername_cb":null,"npn_protocols":null,"alpn_protocols":null,"alpn_select_cb":null,"npn_select_cb":null},"ssl_session":{},"sspi_enabled":false,"ca_file":"/etc/ssl/certs/ca-certificates.crt","ca_path":null,"cert":null,"cert_store":null,"ciphers":null,"key":null,"ssl_timeout":null,"ssl_version":null,"verify_callback":null,"verify_depth":5,"verify_mode":1},"http_method":"post"},"params":{"oauth_token":"29bbf7bca126b332fcca","oauth_token_secret":"b5aadf842531769ab0ea","user_id":"6156679_f57bad"},"response":{"date":["Thu, 30 Jun 2016 06:36:05 GMT"],"server":["Apache"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block"],"x-content-type-options":["nosniff"],"access-control-allow-origin":["*"],"access-control-allow-methods":["GET,POST,OPTIONS"],"access-control-allow-headers":["Content-Type"],"access-control-allow-credentials":["false"],"access-control-max-age":["60"],"content-disposition":["attachment"],"cache-control":["max-age=0, private, must-revalidate"],"x-logjam-request-id":["xws-production-97cdf7854baf41ceb026a0cbcab7bd06"],"x-logjam-request-action":["WebService::EndpointController#get_v1_users_me"],"x-request-id":["97c2c54a-265d-40f2-9c69-57f90a84278f"],"x-runtime":["0.163394"],"x-powered-by":["Phusion Passenger 4.0.60"],"set-cookie":["c_=5b5052e30c89f36eb5020ef50d9777de; domain=.xing.com; path=/; expires=Fri, 01 Jul 2016 06:36:05 -0000; secure; HttpOnly"],"etag":["W/\"0e36daef29dccf3d1f30809c037a8a23-gzip\""],"status":["200 OK"],"vary":["Accept-Encoding"],"content-length":["1279"],"content-type":["application/json; charset=utf-8"]}},"raw_info":{"id":"6156679_f57bad","active_email":"mail.gamal@gmail.com","time_zone":{"utc_offset":2.0,"name":"Africa/Cairo"},"display_name":"AlSayed AbdulAzeem","academic_title":null,"first_name":"AlSayed","last_name":"AbdulAzeem","gender":"m","page_name":"AlSayed_AbdulAzeem","birth_date":{"year":1988,"month":3,"day":29},"wants":"Software Engineering, Data Engineering","haves":"PHP,Python,Django Framework,Ruby on Rails,Scala,openstack,linux,AWS,Ruby,Node.js,angularJS","top_haves":null,"interests":null,"web_profiles":{},"badges":[],"legal_information":{"preview_content":null},"photo_urls":{"large":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.140x185.jpg","maxi_thumb":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.70x93.jpg","medium_thumb":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.57x75.jpg","mini_thumb":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.18x24.jpg","thumb":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.30x40.jpg","size_32x32":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.32x32.jpg","size_48x48":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.48x48.jpg","size_64x64":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.64x64.jpg","size_96x96":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.96x96.jpg","size_128x128":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.128x128.jpg","size_192x192":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.192x192.jpg","size_256x256":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.256x256.jpg","size_1024x1024":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.1024x1024.jpg","size_original":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.original.jpg"},"photo_attributes":{"uploaded":true},"permalink":"https://www.xing.com/profile/AlSayed_AbdulAzeem","languages":{"en":null},"employment_status":"EMPLOYEE","organisation_member":null,"instant_messaging_accounts":{},"educational_background":{"degree":"BsC Electronics  and ComputerEngineering","primary_school":null,"schools":[{"name":"Mansoura University","subject":"Computer Engineering","degree":"BSC Electronics and Computer Engineering","begin_date":"2005-09","end_date":"2011-11","notes":null,"id":"1_dc3ed0"}],"qualifications":[]},"professional_experience":{"primary_company":{"id":"4728080_6c4623","name":"MaTeS","url":"http://www.3MaTeS.com","tag":"MATES","title":"ENG","begin_date":null,"end_date":null,"description":null,"discipline":null,"until_now":true,"industry":"OTHERS","industries":[{"id":230000,"localized_name":"Other"}],"company_size":null,"career_level":null,"form_of_employment":"FULL_TIME_EMPLOYEE"},"companies":[{"id":"4728080_6c4623","name":"MaTeS","url":"http://www.3MaTeS.com","tag":"MATES","title":"ENG","begin_date":null,"end_date":null,"description":null,"discipline":null,"until_now":true,"industry":"OTHERS","industries":[{"id":230000,"localized_name":"Other"}],"company_size":null,"career_level":null,"form_of_employment":"FULL_TIME_EMPLOYEE"},{"id":"4728083_60c11f","name":"CAT","url":"http://www.catreloaded.com","tag":"CAT","title":"Eng","begin_date":null,"end_date":null,"description":null,"discipline":null,"until_now":true,"industry":"OTHERS","industries":[{"id":230000,"localized_name":"Other"}],"company_size":null,"career_level":null,"form_of_employment":"FULL_TIME_EMPLOYEE"}],"awards":[],"non_primary_companies":[{"_this_is_deprecated_since":"2014-05-08","name":"CAT","url":"http://www.catreloaded.com","tag":"CAT","title":"Eng","begin_date":null,"end_date":null,"description":null,"industry":"OTHERS","company_size":null,"career_level":null}]},"private_address":{"street":null,"zip_code":null,"city":null,"province":null,"country":null,"email":null,"fax":null,"phone":null,"mobile_phone":null},"business_address":{"street":"39 Becho American City Zahraa Maadi Cairo","zip_code":"11435","city":"Mansourah","province":null,"country":"EG","email":"mail.gamal@gmail.com","fax":null,"phone":null,"mobile_phone":null},"premium_services":[]}}}', object_class: OpenStruct))
	  user.id.should equal? 1
	end

	it "should update user info if it was updated for same provider and uid" do
		user = User.create_from_xing(JSON.parse('{"provider":"xing","uid":"6156679_f57bad","info":{"first_name":"AlSayed","last_name":"AbdulAzeem","email":"ag@example.com","image":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.128x128.jpg","url":"https://www.xing.com/profile/AlSayed_AbdulAzeem","name":"AlSayed AbdulAzeem","urls":{"public_profile":"https://www.xing.com/profile/AlSayed_AbdulAzeem"}},"credentials":{"token":"29bbf7bca126b332fcca","secret":"b5aadf842531769ab0ea"},"extra":{"access_token":{"token":"29bbf7bca126b332fcca","secret":"b5aadf842531769ab0ea","consumer":{"key":"c5a8fa5cbc63d8090bfa","secret":"1336afa51cda96edde35f6c86783dca57f789aff","options":{"signature_method":"HMAC-SHA1","request_token_path":"/v1/request_token","authorize_path":"/v1/authorize","access_token_path":"/v1/access_token","proxy":null,"scheme":"header","http_method":"post","oauth_version":"1.0","site":"https://api.xing.com"},"uri":{"scheme":"https","user":null,"password":null,"host":"api.xing.com","port":443,"path":"","query":null,"opaque":null,"fragment":null,"parser":{"regexp":{"SCHEME":"(?-mix:\\A[A-Za-z][A-Za-z0-9+\\-.]*\\z)","USERINFO":"(?-mix:\\A(?:%\\h\\h|[!$\u0026-.0-;=A-Z_a-z~])*\\z)","HOST":"(?-mix:\\A(?:(?\u003cIP-literal\u003e\\[(?:(?\u003cIPv6address\u003e(?:\\h{1,4}:){6}(?\u003cls32\u003e\\h{1,4}:\\h{1,4}|(?\u003cIPv4address\u003e(?\u003cdec-octet\u003e[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5]|\\d)\\.\\g\u003cdec-octet\u003e\\.\\g\u003cdec-octet\u003e\\.\\g\u003cdec-octet\u003e))|::(?:\\h{1,4}:){5}\\g\u003cls32\u003e|\\h{,4}::(?:\\h{1,4}:){4}\\g\u003cls32\u003e|(?:(?:\\h{1,4}:)?\\h{1,4})?::(?:\\h{1,4}:){3}\\g\u003cls32\u003e|(?:(?:\\h{1,4}:){,2}\\h{1,4})?::(?:\\h{1,4}:){2}\\g\u003cls32\u003e|(?:(?:\\h{1,4}:){,3}\\h{1,4})?::\\h{1,4}:\\g\u003cls32\u003e|(?:(?:\\h{1,4}:){,4}\\h{1,4})?::\\g\u003cls32\u003e|(?:(?:\\h{1,4}:){,5}\\h{1,4})?::\\h{1,4}|(?:(?:\\h{1,4}:){,6}\\h{1,4})?::)|(?\u003cIPvFuture\u003ev\\h+\\.[!$\u0026-.0-;=A-Z_a-z~]+))\\])|\\g\u003cIPv4address\u003e|(?\u003creg-name\u003e(?:%\\h\\h|[!$\u0026-.0-9;=A-Z_a-z~])*))\\z)","ABS_PATH":"(?-mix:\\A\\/(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~])*(?:\\/(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~])*)*\\z)","REL_PATH":"(?-mix:\\A(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~])+(?:\\/(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~])*)*\\z)","QUERY":"(?-mix:\\A(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~\\/?])*\\z)","FRAGMENT":"(?-mix:\\A(?:%\\h\\h|[!$\u0026-.0-;=@-Z_a-z~\\/?])*\\z)","OPAQUE":"(?-mix:\\A(?:[^\\/].*)?\\z)","PORT":"(?-mix:\\A[\\x09\\x0a\\x0c\\x0d ]*\\d*[\\x09\\x0a\\x0c\\x0d ]*\\z)"}}},"http":{"address":"api.xing.com","port":443,"local_host":null,"local_port":null,"curr_http_version":"1.1","keep_alive_timeout":2,"last_communicated":null,"close_on_empty_response":false,"socket":null,"started":false,"open_timeout":30,"read_timeout":30,"continue_timeout":null,"debug_output":null,"proxy_from_env":true,"proxy_uri":null,"proxy_address":null,"proxy_port":null,"proxy_user":null,"proxy_pass":null,"use_ssl":true,"ssl_context":{"cert":null,"key":null,"client_ca":null,"ca_file":"/etc/ssl/certs/ca-certificates.crt","ca_path":null,"timeout":null,"verify_mode":1,"verify_depth":5,"renegotiation_cb":null,"verify_callback":null,"cert_store":null,"extra_chain_cert":null,"client_cert_cb":null,"session_id_context":null,"tmp_dh_callback":null,"session_get_cb":null,"session_new_cb":null,"session_remove_cb":null,"tmp_ecdh_callback":null,"servername_cb":null,"npn_protocols":null,"alpn_protocols":null,"alpn_select_cb":null,"npn_select_cb":null},"ssl_session":{},"sspi_enabled":false,"ca_file":"/etc/ssl/certs/ca-certificates.crt","ca_path":null,"cert":null,"cert_store":null,"ciphers":null,"key":null,"ssl_timeout":null,"ssl_version":null,"verify_callback":null,"verify_depth":5,"verify_mode":1},"http_method":"post"},"params":{"oauth_token":"29bbf7bca126b332fcca","oauth_token_secret":"b5aadf842531769ab0ea","user_id":"6156679_f57bad"},"response":{"date":["Thu, 30 Jun 2016 06:36:05 GMT"],"server":["Apache"],"x-frame-options":["SAMEORIGIN"],"x-xss-protection":["1; mode=block"],"x-content-type-options":["nosniff"],"access-control-allow-origin":["*"],"access-control-allow-methods":["GET,POST,OPTIONS"],"access-control-allow-headers":["Content-Type"],"access-control-allow-credentials":["false"],"access-control-max-age":["60"],"content-disposition":["attachment"],"cache-control":["max-age=0, private, must-revalidate"],"x-logjam-request-id":["xws-production-97cdf7854baf41ceb026a0cbcab7bd06"],"x-logjam-request-action":["WebService::EndpointController#get_v1_users_me"],"x-request-id":["97c2c54a-265d-40f2-9c69-57f90a84278f"],"x-runtime":["0.163394"],"x-powered-by":["Phusion Passenger 4.0.60"],"set-cookie":["c_=5b5052e30c89f36eb5020ef50d9777de; domain=.xing.com; path=/; expires=Fri, 01 Jul 2016 06:36:05 -0000; secure; HttpOnly"],"etag":["W/\"0e36daef29dccf3d1f30809c037a8a23-gzip\""],"status":["200 OK"],"vary":["Accept-Encoding"],"content-length":["1279"],"content-type":["application/json; charset=utf-8"]}},"raw_info":{"id":"6156679_f57bad","active_email":"mail.gamal@gmail.com","time_zone":{"utc_offset":2.0,"name":"Africa/Cairo"},"display_name":"AlSayed AbdulAzeem","academic_title":null,"first_name":"AlSayed","last_name":"AbdulAzeem","gender":"m","page_name":"AlSayed_AbdulAzeem","birth_date":{"year":1988,"month":3,"day":29},"wants":"Software Engineering, Data Engineering","haves":"PHP,Python,Django Framework,Ruby on Rails,Scala,openstack,linux,AWS,Ruby,Node.js,angularJS","top_haves":null,"interests":null,"web_profiles":{},"badges":[],"legal_information":{"preview_content":null},"photo_urls":{"large":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.140x185.jpg","maxi_thumb":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.70x93.jpg","medium_thumb":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.57x75.jpg","mini_thumb":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.18x24.jpg","thumb":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.30x40.jpg","size_32x32":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.32x32.jpg","size_48x48":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.48x48.jpg","size_64x64":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.64x64.jpg","size_96x96":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.96x96.jpg","size_128x128":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.128x128.jpg","size_192x192":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.192x192.jpg","size_256x256":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.256x256.jpg","size_1024x1024":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.1024x1024.jpg","size_original":"https://www.xing.com/img/users/2/a/b/0becd7f31.6156679,2.original.jpg"},"photo_attributes":{"uploaded":true},"permalink":"https://www.xing.com/profile/AlSayed_AbdulAzeem","languages":{"en":null},"employment_status":"EMPLOYEE","organisation_member":null,"instant_messaging_accounts":{},"educational_background":{"degree":"BsC Electronics  and ComputerEngineering","primary_school":null,"schools":[{"name":"Mansoura University","subject":"Computer Engineering","degree":"BSC Electronics and Computer Engineering","begin_date":"2005-09","end_date":"2011-11","notes":null,"id":"1_dc3ed0"}],"qualifications":[]},"professional_experience":{"primary_company":{"id":"4728080_6c4623","name":"MaTeS","url":"http://www.3MaTeS.com","tag":"MATES","title":"ENG","begin_date":null,"end_date":null,"description":null,"discipline":null,"until_now":true,"industry":"OTHERS","industries":[{"id":230000,"localized_name":"Other"}],"company_size":null,"career_level":null,"form_of_employment":"FULL_TIME_EMPLOYEE"},"companies":[{"id":"4728080_6c4623","name":"MaTeS","url":"http://www.3MaTeS.com","tag":"MATES","title":"ENG","begin_date":null,"end_date":null,"description":null,"discipline":null,"until_now":true,"industry":"OTHERS","industries":[{"id":230000,"localized_name":"Other"}],"company_size":null,"career_level":null,"form_of_employment":"FULL_TIME_EMPLOYEE"},{"id":"4728083_60c11f","name":"CAT","url":"http://www.catreloaded.com","tag":"CAT","title":"Eng","begin_date":null,"end_date":null,"description":null,"discipline":null,"until_now":true,"industry":"OTHERS","industries":[{"id":230000,"localized_name":"Other"}],"company_size":null,"career_level":null,"form_of_employment":"FULL_TIME_EMPLOYEE"}],"awards":[],"non_primary_companies":[{"_this_is_deprecated_since":"2014-05-08","name":"CAT","url":"http://www.catreloaded.com","tag":"CAT","title":"Eng","begin_date":null,"end_date":null,"description":null,"industry":"OTHERS","company_size":null,"career_level":null}]},"private_address":{"street":null,"zip_code":null,"city":null,"province":null,"country":null,"email":null,"fax":null,"phone":null,"mobile_phone":null},"business_address":{"street":"39 Becho American City Zahraa Maadi Cairo","zip_code":"11435","city":"Mansourah","province":null,"country":"EG","email":"mail.gamal@gmail.com","fax":null,"phone":null,"mobile_phone":null},"premium_services":[]}}}', object_class: OpenStruct))
		user.email.should equal? "ag@example.com"
	end
	it "should return list of 2 contacts given factory token and secret" do
		gamal = create(:user)
		gamal.contacts.count.should.equal? 2
	end
end
